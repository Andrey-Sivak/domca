<?php
/**
 * Template for rendering the "How It Works" block.
 *
 * @package domca
 */

$domca_how_it_works_title  = $attributes['title'] ?? '';
$domca_how_it_works_steps  = $attributes['steps'] ?? array();
$domca_how_it_works_button = $attributes['button'] ?? '';

$domca_how_it_works_base_class = 'wp-block-domca-how-it-works';

$domca_how_it_works_wrapper_attributes = get_block_wrapper_attributes(
	array(
		'class' => 'dm-wrap',
	)
);

// Step image background SVG (from StepImageBg)
$domca_how_it_works_step_image_bg_svg = '<svg
	preserveAspectRatio="none"
	aria-hidden="true"
	viewBox="0 0 157 159"
	fill="none"
	class="' . esc_attr( $domca_how_it_works_base_class . '__step-image-decor' ) . '"
>
	<circle cx="81" cy="79" r="75" fill="#CBA2A2" />
	<path
		d="M7.81485 49.9462C12.6476 40.3648 14.1917 30.7624 24.2971 21.2251C34.8053 12.4414 37.453 12.5835 51.0935 5.85467C61.5583 1.14558 73.1987 0.233715 81 0.337358C83.7073 0.346116 85.9782 0.419418 87.7294 0.369953C94.6004 0.371358 95.0088 2.55753 104.246 4.65552C113.477 7.12521 118.678 10.2163 125.093 15.4634C132.258 20.0713 148.003 39.808 151.548 48.4512C156.211 56.5798 156.677 67.5078 156.608 73.647C156.624 75.6 156.497 77.106 156.34 78.2772C156.273 78.7718 156.121 79 155.973 79C155.973 79 155.973 79 155.973 79C155.788 78.9996 155.608 78.6478 155.577 78.0207C155.427 74.9966 154.876 70.4299 153.237 65.3536C149.827 56.1184 151.177 54.4464 144.481 42.9487C137.044 31.98 130.941 26.7795 118.659 17.7438C105.649 9.86551 101.241 10.7216 81 7.85248C80.7267 7.82879 80.4506 7.80575 80.1716 7.78344C58.5983 7.54427 56.2762 12.2873 39.5418 23.7441C22.4065 35.8725 10.4834 61.2112 10.7319 74.1912C10.6478 75.7417 10.6147 77.3246 10.64 79C10.7289 91.0718 14.5463 106.162 23.4089 119.361C33.197 134.78 53.9067 146.625 73.6574 149.066C75.9769 149.408 78.4368 149.649 81 149.755C100.436 151.384 122.97 140.15 131.514 131.842C141.404 122.682 143.608 119.656 148.746 107.679C151.532 100.692 154.24 90.7168 155.412 81.8811C155.968 77.4346 156.662 78.4085 156.802 82.9899C156.914 89.7279 155.435 95.087 155.342 98.6447C155.012 105.767 154.565 109.153 149.55 116.632C144.354 123.884 143.307 128.363 139.6 132.204C135.344 135.298 136.663 137.086 113.687 150.509C100.802 156.923 89.5962 158.413 81 158.668C73.5252 158.839 67.7925 158.012 63.1236 157.073C52.8377 155.513 33.3152 145.178 22.1877 132.649C10.9018 122.604 0.0256805 95.0671 0.89227 79C0.842074 76.9677 0.855532 75.1765 0.885516 73.6052C1.68013 59.823 3.47853 59.9217 7.81485 49.9462Z"
		fill="#817676"
	/>
</svg>';

// Step text background SVG (from StepTextBg)
$domca_how_it_works_step_text_bg_svg = '<svg
	preserveAspectRatio="none"
	aria-hidden="true"
	viewBox="0 0 347 241"
	fill="none"
	class="' . esc_attr( $domca_how_it_works_base_class . '__step-text-decor' ) . '"
>
	<path
		d="M307 5C326.33 5 342 20.67 342 40V200C342 219.33 326.33 235 307 235H41C21.67 235 6 219.33 6 200V40C6 20.67 21.67 5 41 5H84.5508C89.5253 49.9994 127.675 85 174 85C220.325 85 258.475 49.9994 263.449 5H307Z"
		fill="white"
	/>
	<path
		d="M2.27872 143.563C3.07663 118.054 -0.449966 97.9724 0.0484999 66.8799C0.235662 55.2057 0.616272 47.2583 0.996398 40C2.32231 27.0843 6.13624 12.0351 29.4699 2.73019C33.1929 1.53424 37.108 0.928337 41 0.918302C56.4282 0.865047 71.4905 1.06436 84.5508 1.20645L87.9083 1.17159L88.3214 4.58318C89.6226 17.9505 93.986 28.5664 97.559 34.6323C105.857 47.1063 104.358 50.7877 121.443 64.4947C139.422 76.754 152.6 80.8697 171.622 82.6372C172.354 82.6857 173.148 82.7265 174 82.755C184.558 83.3584 204.4 80.6106 220.81 70.182C237.496 60.2235 248.92 43.8276 252.896 34.3399C257.043 25.1327 260.208 14.8232 261.582 4.79356L261.747 3.13887L263.449 3.12119C275.15 3.45268 285.992 4.00253 294.01 4.20548C298.709 4.32445 302.408 4.48726 305.244 4.65665C306.445 4.72848 307 4.87873 307 5.02704C307 5.02714 307 5.02724 307 5.02733C307 5.212 306.139 5.39358 304.595 5.41691C297.102 5.53017 285.902 5.829 272.671 6.49869C269.214 6.67368 266.188 6.79706 263.449 6.8816L265.319 5.20674C262.893 21.9938 262.148 29.1855 245.368 53.0744C226.18 75.9166 206.377 87.5475 174 88.3087C169.852 88.2643 165.518 87.9298 160.985 87.2012C141.032 83.6265 129.449 78.0081 117.325 69.8334C105.833 61.315 91.5714 49.0468 83.8599 20.948C82.4583 15.3519 81.661 10.1646 81.2232 5.36786L84.5508 8.34789C65.707 7.96812 53.3937 8.36674 41 8.95871C28.8483 9.71141 12.7919 18.0614 11.8998 40C11.9088 40.8387 11.9172 41.6892 11.9247 42.5517C12.4049 97.3997 10.4253 166.559 10.568 200C10.5688 200.155 10.5707 200.308 10.5739 200.461C10.2498 214.215 23.0726 230.451 41 230.142C62.9896 230.065 86.9278 230.069 111.542 230.32C158.661 230.799 216.827 229.589 268.838 230.444C280.683 230.639 293.644 230.845 307 231.056C323.49 231.9 339.194 216.617 338.929 200C339.358 173.449 339.768 149.32 340.102 133.629C340.826 99.6599 340.989 91.3802 340.547 58.6829C340.47 53.0014 340.438 46.6714 340.457 40C341.023 25.0502 328.873 9.48005 313.952 6.23476C308.664 5.00059 306.462 5.09085 307.109 4.75542C307.731 4.53933 311.255 4.08378 316.8 5.44884C333.483 9.78152 340.738 24.1059 343.048 32.1969C343.907 34.9318 344.379 37.5317 344.59 40C345.673 51.8857 345.984 59.723 345.187 77.3633C344.235 98.4188 346.398 108.34 346.149 120.614C345.9 132.889 344.624 132.687 345.607 195.098C345.633 196.752 345.659 198.386 345.684 200C345.996 224.775 324.023 239.995 307 239.45C280.004 239.779 261.278 239.931 246.621 240.077C222.986 240.313 173.635 239.206 135.116 239.605C111.888 239.846 74.1911 239.809 41 239.885C14.5289 240.194 -0.0288233 214.752 0.714937 200.809C0.704689 200.538 0.697283 200.268 0.692624 200C0.0739376 169.134 1.48678 168.881 2.27872 143.563Z"
		fill="#817676"
	/>
</svg>';

$domca_how_it_works_separator = '<svg
			viewBox="0 0 1920 12"
			fill="none"
			class="' . esc_attr( $domca_how_it_works_base_class . '__separator' ) . '"
			preserveAspectRatio="none"
			aria-hidden="true"
	>
		<path d="M1075.47 2.27872C1117.85 3.07663 1151.21 -0.449966 1202.86 0.0484999C1254.52 0.546973 1262.25 2.41764 1321.41 1.99674C1380.56 1.57592 1439.75 2.8554 1466.09 2.08683C1492.42 1.31803 1495.2 3.64238 1532.6 3.12614C1570.01 2.60996 1592.67 2.91336 1625.38 3.66886C1658.09 4.42438 1758.59 5.06938 1795.13 4.14127C1831.67 3.21317 1873.35 4.82355 1898.42 5.20548C1906.23 5.32445 1912.37 5.48726 1917.08 5.65665C1919.08 5.72848 1920 5.87873 1920 6.02704C1920 6.02714 1920 6.02724 1920 6.02733C1920 6.212 1918.57 6.39358 1916.01 6.41691C1903.56 6.53017 1884.95 6.829 1862.97 7.49869C1821.99 8.74744 1817.51 7.36752 1762.16 8.00919C1706.82 8.65086 1673.57 9.93371 1608.46 9.10416C1543.34 8.27468 1528.38 11.746 1436.47 9.77872C1344.55 7.81159 1334.88 11.442 1243.28 11.9247C1151.68 12.4074 1036.06 10.4044 980.84 10.5705C925.623 10.7366 851.463 11.1594 773.187 10.6803C694.91 10.2012 598.281 11.4107 511.876 10.5558C425.473 9.701 303.316 8.62133 246.881 7.89786C190.448 7.17441 176.694 7.01123 122.374 7.45328C91.151 7.70739 48.138 7.46787 11.8059 6.53336C-6.47869 6.06305 -2.33538 5.40821 16.0687 5.09489C42.9815 4.63673 65.0739 4.94281 78.9409 4.12443C106.65 2.48886 118.427 1.86143 153.408 2.81339C188.387 3.76524 204.869 1.60201 225.259 1.85099C245.651 2.10009 245.316 3.37605 348.997 2.39298C452.68 1.40987 509.519 1.15902 548.783 0.923011C588.048 0.686997 670.033 1.7944 734.024 1.39469C798.015 0.995004 928.105 1.36132 980.547 0.706947C1032.99 0.0526252 1033.09 1.48082 1075.47 2.27872Z"/>
	</svg>'
?>

<section
		<?php
        // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped
		echo $domca_how_it_works_wrapper_attributes;
		?>
>

	<?php echo wp_kses( $domca_how_it_works_separator, domca_get_svg_allowed_html() ); ?>
	<?php echo wp_kses( $domca_how_it_works_separator, domca_get_svg_allowed_html() ); ?>

	<div class="<?php echo esc_attr( $domca_how_it_works_base_class . '__wrap dm-container' ); ?>">
		<?php if ( ! empty( $domca_how_it_works_title ) ) : ?>
			<h2 class="<?php echo esc_attr( $domca_how_it_works_base_class . '__title dm-heading dm-heading-h2' ); ?>">
				<?php echo wp_kses_post( $domca_how_it_works_title ); ?>
			</h2>
		<?php endif; ?>

		<?php if ( ! empty( $domca_how_it_works_steps ) && is_array( $domca_how_it_works_steps ) ) : ?>
			<div class="<?php echo esc_attr( $domca_how_it_works_base_class . '__steps' ); ?>">
				<?php foreach ( $domca_how_it_works_steps as $domca_step_index => $domca_step ) : ?>
					<?php
					$domca_step_text     = $domca_step['text'] ?? '';
					$domca_step_image    = $domca_step['image'] ?? array();
					$domca_step_image_id = $domca_step_image['id'] ?? null;
					?>
					<div class="<?php echo esc_attr( $domca_how_it_works_base_class . '__step' ); ?>">
						<div class="<?php echo esc_attr( $domca_how_it_works_base_class . '__step-image' ); ?>">
							<?php echo wp_kses( $domca_how_it_works_step_image_bg_svg, domca_get_svg_allowed_html() ); ?>
							<?php if ( $domca_step_image_id ) : ?>
								<div class="<?php echo esc_attr( $domca_how_it_works_base_class . '__step-image-img' ); ?>">
									<?php echo wp_get_attachment_image( $domca_step_image_id, 'full', false, array() ); ?>
								</div>
							<?php endif; ?>
						</div>

						<div class="<?php echo esc_attr( $domca_how_it_works_base_class . '__step-text' ); ?>">
							<?php echo wp_kses( $domca_how_it_works_step_text_bg_svg, domca_get_svg_allowed_html() ); ?>
							<?php if ( ! empty( $domca_step_text ) ) : ?>
								<p class="<?php echo esc_attr( $domca_how_it_works_base_class . '__step-text-text' ); ?>">
									<?php echo wp_kses_post( $domca_step_text ); ?>
								</p>
							<?php endif; ?>
						</div>
					</div>
				<?php endforeach; ?>
			</div>
		<?php endif; ?>

		<?php if ( ! empty( $domca_how_it_works_button ) ) : ?>
			<p class="<?php echo esc_attr( $domca_how_it_works_base_class . '__button dm-button dm-button-primary' ); ?>">
				<?php echo wp_kses_post( $domca_how_it_works_button ); ?>
			</p>
		<?php endif; ?>
	</div>
</section>
